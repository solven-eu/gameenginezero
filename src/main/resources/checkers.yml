name: Checkers
source: http://www.lecomptoirdesjeux.com/regle-jeu-dames.htm

constants:
  maxX: 10
  maxY: 10

board:
  type: grid
  width: 10
  height: 10
  values: 
    - ""
    - "W"
    - "X"
    - "B"
    - "C"

players:
  -
    id: w
  -
    id: b

setup:
  player: w
  board:
    - " B B B B B"
    - "B B B B B "
    - " B B B B B"
    - "B B B B B "
    - "          "
    - "          "
    - " W W W W W"
    - "W W W W W "
    - " W W W W W"
    - "W W W W W "
  
allowed_moves:
  -
    comment: "White goes rightUp"
    intermediate:
      - "mutator.put('tX',x+1)"
      - "mutator.put('tY',y+1)"
      - "mutator.put('newPiece',y+1 == maxY - 1 ? 'X':'W')"
    conditions:
      - "tX>=0"
      - "tX<maxX"
      - "tY>=0"
      - "tY<maxY"
      - "player.equals('w')"
      - "map.charAt(x,y) == 'W'"
      - "map.charAt(tX,tY) == ' ' || map.charAt(tX,tY) == 'B'"
    mutations:
      - "map.charAt(x,y,' ')"
      - "map.charAt(tX,tY,newPiece)"
      - "map.updateMetadata('player','b')"
  -
    comment: "White goes leftUp"
    intermediate:
      - "mutator.put('tX',x-1)"
      - "mutator.put('tY',y+1)"
      - "mutator.put('newPiece',y+1 == maxY - 1 ? 'X':'W')"
    conditions:
      - "tX>=0"
      - "tX<maxX"
      - "tY>=0"
      - "tY<maxY"
      - "player.equals('w')"
      - "map.charAt(x,y) == 'W'"
      - "map.charAt(tX,tY) == ' ' || map.charAt(tX,tY) == 'B'"
    mutations:
      - "map.charAt(x,y,' ')"
      - "map.charAt(tX,tY,newPiece)"
      - "map.updateMetadata('player','b')"
  -
    comment: "Black goes rightDown"
    intermediate:
      - "mutator.put('tX',x+1)"
      - "mutator.put('tY',y-1)"
      - "mutator.put('newPiece',tY == 0 ? 'C':'B')"
    conditions:
      - "tX>=0"
      - "tX<maxX"
      - "tY>=0"
      - "tY<maxY"
      - "player.equals('b')"
      - "map.charAt(x,y) == 'B'"
      - "map.charAt(tX,tY) == ' ' || map.charAt(tX,tY) == 'W'"
    mutations:
      - "map.charAt(x,y,' ')"
      - "map.charAt(tX,tY,newPiece)"
      - "map.updateMetadata('player','w')"
  -
    comment: "Black goes leftDown"
    intermediate:
      - "mutator.put('tX',x-1)"
      - "mutator.put('tY',y-1)"
      - "mutator.put('newPiece',tY == 0 ? 'C':'B')"
    conditions:
      - "tX>=0"
      - "tX<maxX"
      - "tY>=0"
      - "tY<maxY"
      - "player.equals('b')"
      - "map.charAt(x,y) == 'B'"
      - "map.charAt(tX,tY) == ' ' || map.charAt(tX,tY) == 'W'"
    mutations:
      - "map.charAt(x,y,' ')"
      - "map.charAt(tX,tY,newPiece)"
      - "map.updateMetadata('player','w')"

rendering:
  - 
    comment: Black around the board
    style: "border: black"
    conditions: 
    - 
      "true"
  - 
    comment: Bottom left is black
    style: "bg: black"
    conditions: 
    - 
      "(x+y) % 2 == 0"
  - 
    style: "bg: white"
    conditions: 
    - 
      "(x+y) % 2 == 1"
  -
    style: "item: light_man"
    conditions: 
    - 
      "map.charAt(x,y) == 'W'"
  -
    style: "item: double_light_man"
    conditions: 
    - 
      "map.charAt(x,y) == 'X'"
  -
    style: "item: dark_man"
    conditions: 
    - 
      "map.charAt(x,y) == 'B'"
  -
    style: "item: double_dark_man"
    conditions: 
    - 
      "map.charAt(x,y) == 'C'"
